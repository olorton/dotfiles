#!/usr/bin/env bash

DOTFILES_ROOT="${HOME}/Code/dotfiles/"
[ -d "${HOME}/code" ] && DOTFILES_ROOT="${HOME}/code/dotfiles/"

symlink_dotfile () {
    SOURCE="${1}"
    TARGET="${2}"

    if [ ! -L ${TARGET} ] && [ -f ${TARGET} ]; then
        echo "Backing up file ${TARGET} to ${TARGET}.backup before creating symlink"
        mv ${TARGET} ${TARGET}.backup
    elif [ -L ${TARGET} ] && [ -f ${TARGET} ]; then
        echo "Target link already exists, replacing linked file: ${DOTFILES_ROOT}${SOURCE} -> ${TARGET}"
        rm -f ${TARGET}
    elif [ -e ${TARGET} ]; then
        echo "Cannot overwrite because the destination exists, and is not a file or a link: ${TARGET}"
        exit 1
    else
        echo "Target link does not exist, linking file from dotfiles to: ${TARGET}"
    fi

    ln -s ${DOTFILES_ROOT}${SOURCE} ${TARGET}
}

symlink_dotfile git/gitconfig.symlink ~/.gitconfig
symlink_dotfile tig/tigrc.symlink ~/.tigrc
symlink_dotfile tmux/tmux.conf.symlink ~/.tmux.conf
symlink_dotfile vim/vimrc.symlink ~/.vimrc
symlink_dotfile zsh/zshrc.symlink ~/.zshrc
